local player = game.Players.LocalPlayer
local backpack = player:WaitForChild("Backpack")
local mouse = player:GetMouse()
local event = game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest

local function message(msg)
	event:FireServer("[HD_CHAT] "..msg, "All")
end

local function getcmd(msg)
	return string.split(msg, " ")[1]
end

local function getarg(msg, arg)
	return string.split(msg, " ")[arg]
end

message('| A simple "admin" system made for ROBLOX chat, to be executed with a client side executor. | System messages can be viewed by anyone. | Commands will still work if your chat gets rate limited. | Made by cheesecake. | !help for cmds. |')

local prefix = "!"

local audio = Instance.new("Sound", workspace)
audio.Looped = true

local backshotting = false
local a

local nowe = false

player.Chatted:Connect(function(msg)
	local char = player.Character
	local hum = char:FindFirstChildOfClass("Humanoid") or char:WaitForChild("Humanoid")
	wait(0.5)

	if getcmd(msg) then
		if getcmd(msg) == prefix.."help" then
			message("Commands: "..prefix.."help | "..prefix.."music (id) | "..prefix.."volume (number) | "..prefix.."rejoin | "..prefix.."localkick (plrname) | "..prefix.."btools | "..prefix.."shoot_back (plrname or stop) | !explode | "..prefix.."quickrejoin | "..prefix.."fly")

		elseif getcmd(msg) == prefix.."prefix" then
			prefix = getarg(msg, 2)
			message("Prefix changed to "..getarg(msg, 2))

		elseif getcmd(msg) == prefix.."music" then
			audio.SoundId = "rbxassetid://"..getarg(msg, 2)
			audio:Play()
			message("Music ID set to "..getarg(msg, 2))

		elseif getcmd(msg) == prefix.."volume" then
			audio.Volume = tonumber(getarg(msg, 2))
			message("Music volume set to "..getarg(msg, 2))

		elseif getcmd(msg) == prefix.."rejoin" then
			message("Rejoin will begin in 5 seconds. Please re-execute the script if it does not work after rejoining.")
			wait(5)
			game:GetService("TeleportService"):Teleport(game.PlaceId)
		elseif getcmd(msg) == prefix.."quickrejoin" then
			game:GetService("TeleportService"):Teleport(game.PlaceId)
		elseif getcmd(msg) == prefix.."localkick" then
			local plr = game.Players:FindFirstChild(getarg(msg, 2))
			if plr then
				message("Attempting to destroy player instance and destroy character...")
				local success, info = pcall(function()
					plr.Character:BreakJoints()
					plr:Destroy()
				end)
				if success then
					message("Successfully localkicked player.")
				else
					message("Localkick failed. Info: "..tostring(info))
				end
			end

		elseif getcmd(msg) == prefix.."btools" then
			local backpack = player.Backpack

			local hammer = Instance.new("HopperBin")
			hammer.Name = "Hammer"
			hammer.BinType = 4
			hammer.Parent = backpack

			local cloneTool = Instance.new("HopperBin")
			cloneTool.Name = "Clone"
			cloneTool.BinType = 3
			cloneTool.Parent = backpack

			local grabTool = Instance.new("HopperBin")
			grabTool.Name = "Grab"
			grabTool.BinType = 2
			grabTool.Parent = backpack

			local buildTool = Instance.new("Tool")
			buildTool.Name = "create part"
			buildTool.RequiresHandle = false
			buildTool.Parent = backpack

			buildTool.Activated:Connect(function()
				if mouse.Hit then
					local pos = mouse.Hit.Position
					local part = Instance.new("Part")
					part.Size = Vector3.new(4, 4, 4)
					part.Anchored = true
					part.Position = pos
					part.Parent = workspace
				end
			end)
			
			local buildTool2 = Instance.new("Tool")
			buildTool2.Name = "create part unanchored"
			buildTool2.RequiresHandle = false
			buildTool2.Parent = backpack

			buildTool2.Activated:Connect(function()
				if mouse.Hit then
					local pos = mouse.Hit.Position
					local part = Instance.new("Part")
					part.Size = Vector3.new(4, 4, 4)
					part.Anchored = false
					part.Position = pos
					part.Parent = workspace
				end
			end)

		elseif getcmd(msg) == prefix.."shoot_back" then
			backshotting = not backshotting

			local players = game.Players:GetPlayers()
			local randomPlayer = players[math.random(1, #players)]

			if getarg(msg, 2) == "stop" or backshotting then
				message("Stopped b4ck__sh0t.")
				backshotting = false

				if char:FindFirstChild("ManualWeld") then
					char:FindFirstChild("ManualWeld"):Destroy()
				end

				if a then a:Stop() end
				return
			end

			local target1 = game.Players:FindFirstChild(getarg(msg, 2)) or randomPlayer
			local target = target1.Character or target1.CharacterAdded:Wait()

			if target then
				message("WARNING: This is against Korone's TOS. Don't use near mods. Or just don't use it near anyone like a dumbass. Type !shoot_back again to stop")

				local hrp = target:WaitForChild("HumanoidRootPart")
				local animation = Instance.new("Animation")
				animation.AnimationId = "rbxassetid://148840371"

				local animator = hum:WaitForChild("Animator")
				a = animator:LoadAnimation(animation)

				char:SetPrimaryPartCFrame(hrp.CFrame)
				a:Play()
				a:AdjustSpeed(1.5)

				local weld = Instance.new("ManualWeld")
				weld.Parent = char
				weld.Part0 = char:WaitForChild("HumanoidRootPart")
				weld.Part1 = hrp
			end

		elseif getcmd(msg) == prefix.."explode" then
			local exp = Instance.new("Explosion", char)
			exp.Position = char:WaitForChild("HumanoidRootPart").Position
		elseif getcmd(msg) == prefix.."fly" then
			if not game.Players.LocalPlayer:WaitForChild("PlayerGui"):FindFirstChild("FLYGUIV3") then
				spawn(function()
					if nowe == true then
						message("Stopped flying.")
						nowe = false

						hum:SetStateEnabled(Enum.HumanoidStateType.Climbing,true)
						hum:SetStateEnabled(Enum.HumanoidStateType.FallingDown,true)
						hum:SetStateEnabled(Enum.HumanoidStateType.Flying,true)
						hum:SetStateEnabled(Enum.HumanoidStateType.Freefall,true)
						hum:SetStateEnabled(Enum.HumanoidStateType.GettingUp,true)
						hum:SetStateEnabled(Enum.HumanoidStateType.Jumping,true)
						hum:SetStateEnabled(Enum.HumanoidStateType.Landed,true)
						hum:SetStateEnabled(Enum.HumanoidStateType.Physics,true)
						hum:SetStateEnabled(Enum.HumanoidStateType.PlatformStanding,true)
						hum:SetStateEnabled(Enum.HumanoidStateType.Ragdoll,true)
						hum:SetStateEnabled(Enum.HumanoidStateType.Running,true)
						hum:SetStateEnabled(Enum.HumanoidStateType.RunningNoPhysics,true)
						hum:SetStateEnabled(Enum.HumanoidStateType.Seated,true)
						hum:SetStateEnabled(Enum.HumanoidStateType.StrafingNoPhysics,true)
						hum:SetStateEnabled(Enum.HumanoidStateType.Swimming,true)
						hum:ChangeState(Enum.HumanoidStateType.RunningNoPhysics)
					else 
						nowe = true

						message("Started flying. Type "..prefix.."fly again to stop.")

						for i = 1, 1 do
							spawn(function()

								local hb = game:GetService("RunService").Heartbeat	


								tpwalking = true
								local chr = game.Players.LocalPlayer.Character
								local hum = chr and chr:FindFirstChildWhichIsA("Humanoid")
								while tpwalking and hb:Wait() and chr and hum and hum.Parent do
									if hum.MoveDirection.Magnitude > 0 then
										chr:TranslateBy(hum.MoveDirection)
									end
								end

							end)
						end
						game.Players.LocalPlayer.Character.Animate.Disabled = true
						local Char = game.Players.LocalPlayer.Character
						local Hum = Char:FindFirstChildOfClass("Humanoid") or Char:FindFirstChildOfClass("AnimationController")

						for i,v in next, Hum:GetPlayingAnimationTracks() do
							v:AdjustSpeed(0)
						end
						hum:SetStateEnabled(Enum.HumanoidStateType.Climbing,false)
						hum:SetStateEnabled(Enum.HumanoidStateType.FallingDown,false)
						hum:SetStateEnabled(Enum.HumanoidStateType.Flying,false)
						hum:SetStateEnabled(Enum.HumanoidStateType.Freefall,false)
						hum:SetStateEnabled(Enum.HumanoidStateType.GettingUp,false)
						hum:SetStateEnabled(Enum.HumanoidStateType.Jumping,false)
						hum:SetStateEnabled(Enum.HumanoidStateType.Landed,false)
						hum:SetStateEnabled(Enum.HumanoidStateType.Physics,false)
						hum:SetStateEnabled(Enum.HumanoidStateType.PlatformStanding,false)
						hum:SetStateEnabled(Enum.HumanoidStateType.Ragdoll,false)
						hum:SetStateEnabled(Enum.HumanoidStateType.Running,false)
						hum:SetStateEnabled(Enum.HumanoidStateType.RunningNoPhysics,false)
						hum:SetStateEnabled(Enum.HumanoidStateType.Seated,false)
						hum:SetStateEnabled(Enum.HumanoidStateType.StrafingNoPhysics,false)
						hum:SetStateEnabled(Enum.HumanoidStateType.Swimming,false)
						hum:ChangeState(Enum.HumanoidStateType.Swimming)
					end
					
					if game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Humanoid").RigType == Enum.HumanoidRigType.R6 then
						
						local plr = game.Players.LocalPlayer
						local torso = plr.Character.Torso
						local flying = true
						local deb = true
						local ctrl = {f = 0, b = 0, l = 0, r = 0}
						local lastctrl = {f = 0, b = 0, l = 0, r = 0}
						local maxspeed = 50
						local speed = 0
						
						local bg = Instance.new("BodyGyro", torso)
						bg.P = 9e4
						bg.maxTorque = Vector3.new(9e9, 9e9, 9e9)
						bg.cframe = torso.CFrame
						local bv = Instance.new("BodyVelocity", torso)
						bv.velocity = Vector3.new(0,0.1,0)
						bv.maxForce = Vector3.new(9e9, 9e9, 9e9)
						if nowe == true then
							plr.Character.Humanoid.PlatformStand = true
						end
						while nowe == true or game:GetService("Players").LocalPlayer.Character.Humanoid.Health == 0 do
							game:GetService("RunService").RenderStepped:Wait()

							if ctrl.l + ctrl.r ~= 0 or ctrl.f + ctrl.b ~= 0 then
								speed = speed+.5+(speed/maxspeed)
								if speed > maxspeed then
									speed = maxspeed
								end
							elseif not (ctrl.l + ctrl.r ~= 0 or ctrl.f + ctrl.b ~= 0) and speed ~= 0 then
								speed = speed-1
								if speed < 0 then
									speed = 0
								end
							end
							if (ctrl.l + ctrl.r) ~= 0 or (ctrl.f + ctrl.b) ~= 0 then
								bv.velocity = ((game.Workspace.CurrentCamera.CoordinateFrame.lookVector * (ctrl.f+ctrl.b)) + ((game.Workspace.CurrentCamera.CoordinateFrame * CFrame.new(ctrl.l+ctrl.r,(ctrl.f+ctrl.b)*.2,0).p) - game.Workspace.CurrentCamera.CoordinateFrame.p))*speed
								lastctrl = {f = ctrl.f, b = ctrl.b, l = ctrl.l, r = ctrl.r}
							elseif (ctrl.l + ctrl.r) == 0 and (ctrl.f + ctrl.b) == 0 and speed ~= 0 then
								bv.velocity = ((game.Workspace.CurrentCamera.CoordinateFrame.lookVector * (lastctrl.f+lastctrl.b)) + ((game.Workspace.CurrentCamera.CoordinateFrame * CFrame.new(lastctrl.l+lastctrl.r,(lastctrl.f+lastctrl.b)*.2,0).p) - game.Workspace.CurrentCamera.CoordinateFrame.p))*speed
							else
								bv.velocity = Vector3.new(0,0,0)
							end
							--	game.Players.LocalPlayer.Character.Animate.Disabled = true
							bg.cframe = game.Workspace.CurrentCamera.CoordinateFrame * CFrame.Angles(-math.rad((ctrl.f+ctrl.b)*50*speed/maxspeed),0,0)
						end
						ctrl = {f = 0, b = 0, l = 0, r = 0}
						lastctrl = {f = 0, b = 0, l = 0, r = 0}
						speed = 0
						bg:Destroy()
						bv:Destroy()
						plr.Character.Humanoid.PlatformStand = false
						game.Players.LocalPlayer.Character.Animate.Disabled = false
						tpwalking = false
						
					else
						local plr = game.Players.LocalPlayer
						local UpperTorso = plr.Character.UpperTorso
						local flying = true
						local deb = true
						local ctrl = {f = 0, b = 0, l = 0, r = 0}
						local lastctrl = {f = 0, b = 0, l = 0, r = 0}
						local maxspeed = 50
						local speed = 0
						
						local bg = Instance.new("BodyGyro", UpperTorso)
						bg.P = 9e4
						bg.maxTorque = Vector3.new(9e9, 9e9, 9e9)
						bg.cframe = UpperTorso.CFrame
						local bv = Instance.new("BodyVelocity", UpperTorso)
						bv.velocity = Vector3.new(0,0.1,0)
						bv.maxForce = Vector3.new(9e9, 9e9, 9e9)
						if nowe == true then
							plr.Character.Humanoid.PlatformStand = true
						end
						while nowe == true or game:GetService("Players").LocalPlayer.Character.Humanoid.Health == 0 do
							wait()

							if ctrl.l + ctrl.r ~= 0 or ctrl.f + ctrl.b ~= 0 then
								speed = speed+.5+(speed/maxspeed)
								if speed > maxspeed then
									speed = maxspeed
								end
							elseif not (ctrl.l + ctrl.r ~= 0 or ctrl.f + ctrl.b ~= 0) and speed ~= 0 then
								speed = speed-1
								if speed < 0 then
									speed = 0
								end
							end
							if (ctrl.l + ctrl.r) ~= 0 or (ctrl.f + ctrl.b) ~= 0 then
								bv.velocity = ((game.Workspace.CurrentCamera.CoordinateFrame.lookVector * (ctrl.f+ctrl.b)) + ((game.Workspace.CurrentCamera.CoordinateFrame * CFrame.new(ctrl.l+ctrl.r,(ctrl.f+ctrl.b)*.2,0).p) - game.Workspace.CurrentCamera.CoordinateFrame.p))*speed
								lastctrl = {f = ctrl.f, b = ctrl.b, l = ctrl.l, r = ctrl.r}
							elseif (ctrl.l + ctrl.r) == 0 and (ctrl.f + ctrl.b) == 0 and speed ~= 0 then
								bv.velocity = ((game.Workspace.CurrentCamera.CoordinateFrame.lookVector * (lastctrl.f+lastctrl.b)) + ((game.Workspace.CurrentCamera.CoordinateFrame * CFrame.new(lastctrl.l+lastctrl.r,(lastctrl.f+lastctrl.b)*.2,0).p) - game.Workspace.CurrentCamera.CoordinateFrame.p))*speed
							else
								bv.velocity = Vector3.new(0,0,0)
							end

							bg.cframe = game.Workspace.CurrentCamera.CoordinateFrame * CFrame.Angles(-math.rad((ctrl.f+ctrl.b)*50*speed/maxspeed),0,0)
						end
						ctrl = {f = 0, b = 0, l = 0, r = 0}
						lastctrl = {f = 0, b = 0, l = 0, r = 0}
						speed = 0
						bg:Destroy()
						bv:Destroy()
						plr.Character.Humanoid.PlatformStand = false
						game.Players.LocalPlayer.Character.Animate.Disabled = false
						tpwalking = false
					end
				end)
			end
		end
	end
end)
